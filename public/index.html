<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xray Auto-Connect</title>
    <link rel="stylesheet" href="style.css">
    <script src="vs/loader.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Xray Auto-Connect</h1>
            <button id="logoutBtn" class="logout-btn">Logout</button>
        </header>
        
        <nav class="tabs">
            <button class="tab-btn active" data-tab="status-tab">Status</button>
            <button class="tab-btn" data-tab="connections-tab">Connections</button>
            <button class="tab-btn" data-tab="configs-tab">Configs</button>
            <button class="tab-btn" data-tab="speed-test-tab">Speed Test</button>
            <button class="tab-btn" data-tab="add-config-tab">Add Config</button>
            <button class="tab-btn" data-tab="logs-tab">Logs</button>
        </nav>
 
        <main class="tab-content">
            <section id="status-tab" class="tab-pane active">
                <div class="status-summary">
                    <div class="summary-card">
                        <div class="summary-icon">üìä</div>
                        <div class="summary-info">
                            <div class="summary-label">Total Connections</div>
                            <div class="summary-value" id="totalConnections">0</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon running-icon">üü¢</div>
                        <div class="summary-info">
                            <div class="summary-label">Running</div>
                            <div class="summary-value" id="runningConnections">0</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon stopped-icon">üî¥</div>
                        <div class="summary-info">
                            <div class="summary-label">Stopped</div>
                            <div class="summary-value" id="stoppedConnections">0</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon error-icon">‚ö†Ô∏è</div>
                        <div class="summary-info">
                            <div class="summary-label">Errors</div>
                            <div class="summary-value" id="errorConnections">0</div>
                        </div>
                    </div>
                </div>
                <div class="status-actions">
                    <button id="goToConnectionsBtn" class="action-btn">Manage Connections</button>
                </div>
                
                <!-- Server Resources Section -->
                <div class="server-resources">
                    <h3 class="section-title">Server Resources</h3>
                    <div class="resources-grid">
                        <div class="resource-card">
                            <div class="resource-header">
                                <div class="resource-icon ram-icon">üíæ</div>
                                <div class="resource-info">
                                    <div class="resource-title">Memory Usage</div>
                                    <div class="resource-value" id="ramUsage">--</div>
                                </div>
                            </div>
                            <div class="resource-progress">
                                <div class="progress-track">
                                    <div class="progress-fill ram-fill" id="ramProgress" style="width: 0%"></div>
                                </div>
                                <div class="progress-details">
                                    <span id="ramUsed">0 GB</span>
                                    <span id="ramTotal">/ 0 GB</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="resource-card">
                            <div class="resource-header">
                                <div class="resource-icon cpu-icon">‚öôÔ∏è</div>
                                <div class="resource-info">
                                    <div class="resource-title">CPU Usage</div>
                                    <div class="resource-value" id="cpuUsage">--</div>
                                </div>
                            </div>
                            <div class="resource-progress">
                                <div class="progress-track">
                                    <div class="progress-fill cpu-fill" id="cpuProgress" style="width: 0%"></div>
                                </div>
                                <div class="progress-details">
                                    <span id="cpuCores">0 Cores</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="resource-card">
                            <div class="resource-header">
                                <div class="resource-icon disk-icon">üíø</div>
                                <div class="resource-info">
                                    <div class="resource-title">Disk Usage</div>
                                    <div class="resource-value" id="diskUsage">--</div>
                                </div>
                            </div>
                            <div class="resource-progress">
                                <div class="progress-track">
                                    <div class="progress-fill disk-fill" id="diskProgress" style="width: 0%"></div>
                                </div>
                                <div class="progress-details">
                                    <span id="diskUsed">0 GB</span>
                                    <span id="diskTotal">/ 0 GB</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="resource-card">
                            <div class="resource-header">
                                <div class="resource-icon network-icon">üåê</div>
                                <div class="resource-info">
                                    <div class="resource-title">Network</div>
                                    <div class="resource-value" id="networkConnections">--</div>
                                </div>
                            </div>
                            <div class="network-stats">
                                <div class="network-stat">
                                    <span class="stat-label">Inbound</span>
                                    <span class="stat-value" id="networkInbound">0 MB</span>
                                </div>
                                <div class="network-stat">
                                    <span class="stat-label">Outbound</span>
                                    <span class="stat-value" id="networkOutbound">0 MB</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="resources-footer">
                        <span class="last-updated">Last updated: <span id="resourcesLastUpdated">--</span></span>
                        <button id="refreshResourcesBtn" class="refresh-btn">üîÑ Refresh</button>
                    </div>
                </div>
            </section>
 
            <section id="connections-tab" class="tab-pane">
                <div class="section-header">
                    <h2>Connection List</h2>
                    <div class="header-actions">
                        <button id="startAllConnectionsBtn" class="btn-success">Start All</button>
                        <button id="stopAllConnectionsBtn" class="btn-danger">Stop All</button>
                    </div>
                </div>
                <div id="connectionsList" class="connections-list">
                    <!-- Connection cards will be loaded here -->
                </div>
                <div id="noConnectionsMessage" class="no-connections-message" style="display: none;">
                    <p>No connections in list. Add configs from Configs tab.</p>
                </div>
            </section>
 
            <section id="configs-tab" class="tab-pane">
                <div class="section-header">
                    <h2>Manage Configs</h2>
                    <div class="header-actions">
                        <button id="testLatencyBtn" class="btn-primary">Run All Tests</button>
                        <span id="testStatus"></span>
                    </div>
                </div>
                <div id="accordionContainer" class="accordion">
                    <!-- Accordion items will be loaded here -->
                </div>
            </section>
 
            <section id="speed-test-tab" class="tab-pane">
                <div class="section-header">
                    <h2>Speed Test</h2>
                </div>
                <div class="speed-test-container">
                    <div class="speed-test-controls">
                        <div class="connection-selector">
                            <label for="speedTestConnection">Test Connection</label>
                            <select id="speedTestConnection">
                                <option value="">Select a connection...</option>
                            </select>
                        </div>
                        <button id="startSpeedTestBtn" class="btn-primary speed-test-btn">Start Speed Test</button>
                        <button id="resetSpeedTestBtn" class="btn-secondary speed-test-btn">Reset</button>
                    </div>
                    
                    <div class="speed-test-status">
                        <div class="status-phase" id="speedTestPhase">Ready</div>
                        <div class="status-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="speedTestProgress"></div>
                            </div>
                            <div class="progress-text" id="speedTestProgressText">0%</div>
                        </div>
                    </div>
 
                    <div class="speed-test-results">
                        <div class="speed-metric">
                            <div class="metric-icon download-icon">‚Üì</div>
                            <div class="metric-info">
                                <div class="metric-label">Download</div>
                                <div class="metric-value" id="downloadSpeed">0.00</div>
                                <div class="metric-unit">Mbps</div>
                            </div>
                            <div class="metric-chart">
                                <canvas id="downloadChart"></canvas>
                            </div>
                        </div>
 
                        <div class="speed-metric">
                            <div class="metric-icon upload-icon">‚Üë</div>
                            <div class="metric-info">
                                <div class="metric-label">Upload</div>
                                <div class="metric-value" id="uploadSpeed">0.00</div>
                                <div class="metric-unit">Mbps</div>
                            </div>
                            <div class="metric-chart">
                                <canvas id="uploadChart"></canvas>
                            </div>
                        </div>
 
                        <div class="speed-metric">
                            <div class="metric-icon ping-icon">‚ö°</div>
                            <div class="metric-info">
                                <div class="metric-label">Ping</div>
                                <div class="metric-value" id="pingValue">0</div>
                                <div class="metric-unit">ms</div>
                            </div>
                            <div class="metric-chart">
                                <canvas id="pingChart"></canvas>
                            </div>
                        </div>
 
                        <div class="speed-metric">
                            <div class="metric-icon jitter-icon">‚âà</div>
                            <div class="metric-info">
                                <div class="metric-label">Jitter</div>
                                <div class="metric-value" id="jitterValue">0</div>
                                <div class="metric-unit">ms</div>
                            </div>
                            <div class="metric-chart">
                                <canvas id="jitterChart"></canvas>
                            </div>
                        </div>
                    </div>
 
                    <div class="speed-test-error" id="speedTestError"></div>
                </div>
            </section>
 
            <section id="add-config-tab" class="tab-pane">
                <h2>Add New Configuration</h2>
                <div class="add-config-form">
                    <div class="form-group">
                        <label for="newConfigName">Config Name</label>
                        <input type="text" id="newConfigName" placeholder="e.g. My Server">
                    </div>
                    <div class="form-group">
                        <label>Configuration JSON</label>
                        <div id="editorContainer" style="height: 400px; border: 1px solid #ddd; border-radius: 4px; margin: 10px 0;"></div>
                    </div>
                    <button id="addConfigBtn" class="btn-success">Add Config</button>
                </div>
            </section>
 
            <section id="logs-tab" class="tab-pane">
                <div class="section-header">
                    <h2>System Logs</h2>
                </div>
                <pre id="logViewer" class="log-viewer"></pre>
            </section>
        </main>
    </div>
    <script>
        // Check authentication before loading main script
        const token = localStorage.getItem('authToken');
        if (!token) {
            window.location.href = '/login.html';
        }
    </script>
    <script src="script.js"></script>
</body>
</html>
